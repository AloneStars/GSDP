<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.gsdp.dao.GroupDao">
    
    <sql id="columns">
    	group_id,group_icon,group_name,group_dec,group_contact,group_address,group_type,owner
    </sql>
    
    <insert id="addAdmin">
    	insert ignore admin values(#{userId},#{groupId});
    </insert>
    
    
    <delete id="deleteAdmin">
    	delete from admin
    	<where>
    		user_id = #{userId} and group_id = #{groupId};
    	</where>
    </delete>
    
    
    <update id="changeOwner">
    	update `group`
    	<set>
    		owner = #{userId}
    	</set>
    	<where>
    		group_id = #{groupId};
    	</where>
    </update>
    
    
    <insert id="addMember">
    	insert ignore member values(#{userId},#{groupId});
    </insert>
    
    
    <delete id="deleteMember">
    	delete from member
    	<where>
    		user_id = #{userId} and group_id = #{groupId};
    	</where>
    </delete>
    
    
    <insert id="addGroup" keyProperty="groupId">
    	insert ignore `group`(group_icon,group_name,group_dec,group_contact,group_address,group_type,owner) 
    	values(#{groupIcon},#{groupName},#{groupDec},#{groupContact},#{groupAddress},#{groupType},#{owner});
    </insert>
    
    
    <!-- 这个sql存在一定的问题..TODO：sql语句已解决，等待对方确认 -->
    <update id="updateGroup">
    	update `group`
    	<set>
    		<if test="groupIcon != null and !groupIcon.equals('')">
    			group_icon = #{groupIcon},
    		</if>
    			group_type = #{groupType},
    		<if test="groupName != null and !groupName.equals('')">
    			group_name = #{groupName},
    		</if>
    		<if test="groupDec != null and !groupDec.equals('')">
    			group_dec = #{groupDec},
    		</if>
    		<if test="groupAddress != null and !groupAddress.equals('')">
    			group_address = #{groupAddress},
    		</if>
    		<if test="groupContact != null and !groupContact.equals('')">
    			group_contact = #{groupContact},
    		</if>
    			group_type = #{groupType},
    			owner = #{owner}
    	</set>
    	<where>
    		group_id = #{groupId};
    	</where>
    </update>
    
    <select id="getGroupMessage" resultType="Group">
    	select
    	<include refid="columns"/>
    	from `group`
    	<where>
    		group_id = #{groupId};
    	</where>
    </select>
    
    
    <select id="getGroupMessageByType" resultType="Group">
    	select
    	<include refid="columns"/>
    	from `group`
    	<where>
    		group_type = #{groupType};
    	</where>
    </select>
    
    
    <select id="getAllGroupMessage" resultType="Group">
    	select
    	<include refid="columns"/>
    	from `group`;
    </select>
</mapper>
